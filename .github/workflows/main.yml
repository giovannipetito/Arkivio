stages:
  - build
  - deploy

# Publishes a Dev release to the SFTP server (in the folder /pub/Arkivio/releases/dev).
# This job can be triggered manually on develop branch.
# No tag is created and no email is sent.
publish-dev-release:
  stage: deploy
  artifacts:
    expire_in: 2 days
    when: always
    paths:
      - app/build/outputs/
  script:
    - ./gradlew clean
    # - chmod +x ./scripts/download-translations.sh && ./scripts/download-translations.sh
    - ./gradlew uploadToSftpRelease -Prelease.scope=dev
  only:
    - develop
  when: manual

# Publishes a Snapshot release to the SFTP server (in the folder /pub/Arkivio/releases/snapshot).
# This job can be triggered manually on feature and hotfix branches.
# No tag is created and no email is sent.
publish-snapshot-release:
  stage: deploy
  artifacts:
    expire_in: 2 days
    when: always
    paths:
      - app/build/outputs/
  script:
    - ./gradlew clean
    # - chmod +x ./scripts/download-translations.sh && ./scripts/download-translations.sh
    - ./gradlew uploadToSftpRelease -Prelease.scope=snapshot
  only:
    - /^feature\/.*$/
    - /^hotfix\/.*$/
  when: manual

# Increments the major version and publishes a new release (in the folder /pub/Arkivio/releases).
# This job can be triggered manually on release/* branches.
# Tag is created and email is sent.
release-major-increment:
  stage: deploy
  artifacts:
    expire_in: 2 days
    when: always
    paths:
      - app/build/outputs/
      # - C:\Users\giovanni.petito\StudioProjects\Arkivio\app\build\outputs\apk\debug
      # - C:\Users\giovanni.petito\StudioProjects\wingoui\wingo\build\outputs\apk\ip1800\release
  script:
    - ./gradlew clean
    # - chmod +x ./scripts/download-translations.sh && ./scripts/download-translations.sh
    - ./gradlew incrementVersion -Prelease.scope=major
    - ./gradlew uploadToSftpRelease -Prelease.scope=major
    - ./gradlew sendEmail
    - ./gradlew pushVersion
  only:
    - /^release\/.*$/
  when: manual

# Increments the minor version and publishes a new release (in the folder /pub/Arkivio/releases).
# This job can be triggered manually on release/* branches.
# Tag is created and email is sent.
release-minor-increment:
  stage: deploy
  artifacts:
    expire_in: 2 days
    when: always
    paths:
      - app/build/outputs/
  script:
    - ./gradlew clean
    # - chmod +x ./scripts/download-translations.sh && ./scripts/download-translations.sh
    - ./gradlew incrementVersion -Prelease.scope=minor
    - ./gradlew uploadToSftpRelease -Prelease.scope=minor
    - ./gradlew sendEmail
    - ./gradlew pushVersion
  only:
    - /^release\/.*$/
  when: manual

# Increments the patch version and publishes a new release (in the folder /pub/Arkivio/releases).
# This job can be triggered manually on release/* branches.
# Tag is created and email is sent.
release-patch-increment:
  stage: deploy
  artifacts:
    expire_in: 2 days
    when: always
    paths:
      - app/build/outputs/
  script:
    - ./gradlew clean
    # - chmod +x ./scripts/download-translations.sh && ./scripts/download-translations.sh
    - ./gradlew incrementVersion -Prelease.scope=patch
    - ./gradlew uploadToSftpRelease -Prelease.scope=patch
    - ./gradlew sendEmail
    - ./gradlew pushVersion
  only:
    - /^release\/.*$/
  when: manual